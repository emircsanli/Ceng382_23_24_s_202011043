@page
@model WebApp1.Pages.ReservationTableModel
@{
    ViewData["Title"] = "Reservation Table";
}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="../css/reservationTable.css">

<div class="panel">
    <div class="panel-heading">
        <div class="row">
            <div class="col col-sm-12 col-xs-12" style="display: flex; justify-content: space-between; align-items: center;">
                <h4 class="title">Reservation Table</h4>
                <a asp-page="/CreateReservation" data-tip="add" class="btn btn-primary"><i class="fa fa-add"></i> Create New Reservation</a>
            </div>
        </div>
    </div>

    <div class="panel-body table-responsive">
        <!-- Filtreleme Formu -->
        <form method="get" asp-page-handler="Filtered" class="form-inline d-flex justify-content-start" style="margin-bottom: 10px;">
            <div class="form-group mx-sm-2">
                <label for="roomName" style="color:white; margin-right: 5px;">Room Name:</label>
                <input type="text" class="form-control" id="roomName" name="roomName" placeholder="Enter room name" value="@Model.RoomName" />
            </div>
            <div class="form-group mx-sm-2">
                <label for="capacity" style="color:white; margin-right: 5px;">Capacity:</label>
                <input type="number" class="form-control" id="capacity" name="capacity" placeholder="Enter capacity" value="@Model.Capacity" />
            </div>
            <div class="form-group mx-sm-2">
                <label for="startDate" style="color:white; margin-right: 5px;">Start Date:</label>
                <input type="date" class="form-control" id="startDate" name="startDate" placeholder="Filtered by start date" value="@Model.StartDate.ToString("yyyy-MM-dd")" />
            </div>
            <div class="form-group mx-sm-2">
                <label for="endDate" style="color:white; margin-right: 5px;">End Date:</label>
                <input type="date" class="form-control" id="endDate" name="endDate" placeholder="Filtered by end date" value="@Model.EndDate.ToString("yyyy-MM-dd")" />
            </div>
            <button type="submit" class="btn btn-primary mx-sm-2" style="margin-top: 22px; height: 40px; width: 100px;">Filter</button>
        </form>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Time</th>
                    @foreach (var day in Model.DaysOfWeek)
                    {
                        <th>@day</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var hour in Model.HoursOfDay)
                {
                    <tr>
                        <td>@hour</td>
                        @foreach (var day in Model.DaysOfWeek)
                        {
                            <td>
                                @{
                                    var reservations = Model.IReservations.Where(r => r.Date.DayOfWeek.ToString() == day && r.Time.ToString("HH:mm") == hour).ToList();
                                }
                                @if (reservations.Any())
                                {
                                    foreach (var reservation in reservations)
                                    {
                                        <div class="reservation-item">
                                            @reservation.ReserverName
                                            <form method="post" asp-page-handler="Edit" asp-route-id="@reservation.Id" style="display:inline">
                                                <button type="button" onclick="showInputForm('@reservation.Id')" class="btn btn-sm btn-primary"><i class="fa fa-edit"></i></button>
                                                <input id="eRoomName-@reservation.Id" style="display:none" type="text" name="roomName" value="@reservation.Room.RoomName" />
                                                <input id="eDate-@reservation.Id" style="display:none" type="date" name="date" value="@reservation.Date.ToString("yyyy-MM-dd")" />
                                                <input id="eTime-@reservation.Id" style="display:none" type="time" name="time" value="@reservation.Time.ToString(@"hh\:mm\:ss")" />
                                                <button id="eOkeyButton-@reservation.Id" style="display:none" type="submit" class="btn btn-sm btn-success"><i class="fa fa-check-circle"></i></button>
                                            </form>
                                            <form method="post" asp-page-handler="Remove" asp-route-id="@reservation.Id" style="display:inline" onsubmit="return confirm('Are you sure you want to delete this?');">
                                                <button type="submit" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i></button>
                                            </form>
                                        </div>
                                    }
                                }
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
function showInputForm(id) {
    document.getElementById('eRoomName-' + id).style.display = 'inline';
    document.getElementById('eDate-' + id).style.display = 'inline';
    document.getElementById('eTime-' + id).style.display = 'inline';
    document.getElementById('eOkeyButton-' + id).style.display = 'inline';
}
</script>